{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./examples/permalink.js","webpack:///./src/format/FeatureHash.js","webpack:///./src/format/FeatureHashStyleType.js"],"names":["exports","module","angular","ngeoMapModule","name","ngeoMiscDebounce","ngeoStatemanagerModule","mapComponent","controller","bindings","template","component","MapComponentController","ngeoLocation","ngeoDebounce","map","ngeoLocation_","ngeoDebounce_","prototype","$onInit","view","getView","zoom","getParam","undefined","x","y","center","setCenter","setZoom","updateParams","Math","round","on","e","getCenter","params","getZoom","drawComponent","DrawComponentController","$scope","layer","scope_","featureSeq_","interaction","vectorSource","getSource","olInteractionDraw","type","source","setActive","addInteraction","ngeoMiscDecorate","feature","set","fhFormat","ngeoFormatFeatureHash","setStyle","olStyleStyle","stroke","olStyleStroke","color","width","features","getFeatures","encodedFeatures","writeFeatures","$applyAsync","readFeatures","length","addFeatures","clearLayer","clear","deleteParam","MainController","olMap","layers","olLayerTile","olSourceOSM","olSourceVector","vectorLayer","olLayerVector","setMap","opt_options","olFormatTextFeature","call","options","accuracy_","accuracy","ACCURACY_","encodeStyles_","encodeStyles","propertiesFunction_","properties","defaultPropertiesFunction_","setStyle_","prevX_","prevY_","LegacyProperties_","propertiesType","defaultValues_","defaultValues","olUtilInherits","StyleTypes_","ngeoFormatFeatureHashStyleType","LINE_STRING","POINT","POLYGON","readFeature","readGeometry","writeFeature","writeGeometry","CHAR64_","getProperties","encodeSignedNumber_","num","signedNum","encodeNumber_","encodedNumber","charAt","styles","geometryType","encodedStyles","styleType","googAsserts","assert","i","style","fillStyle","getFill","imageStyle","getImage","strokeStyle","getStroke","textStyle","getText","encodeStylePolygon_","encodeStyleLine_","encodeStylePoint_","encodeStyleText_","encodeStyleStroke_","olStyleCircle","radius","getRadius","push","encodeURIComponent","encodeStyleFill_","opt_propertyName","propertyName","fillColor","getColor","Array","isArray","fillColorRgba","olColor","fillColorHex","ngeoUtils","rgbArrayToHex","strokeColor","strokeColorRgba","strokeColorHex","strokeWidth","getWidth","fontStyle","getFont","font","split","readLineStringGeometry_","text","substring","flatCoordinates","decodeCoordinates_","olGeomLineString","olGeomGeometryLayout","XY","readMultiLineStringGeometry_","ends","lineStrings","ii","olGeomMultiLineString","readPointGeometry_","olGeomPoint","readMultiPointGeometry_","olGeomMultiPoint","readPolygonGeometry_","rings","end","olGeomPolygon","readMultiPolygonGeometry_","endss","polygons","j","jj","olGeomMultiPolygon","setStyleInFeature_","getStyleProperties_","fontSize","fontColor","pointRadius","olStyleFill","fill","olStyleText","image","setStyleProperties_","geometry","getGeometry","ngeoFormatFeatureProperties","IS_TEXT","parseFloat","indexOf","clone","key","value","setProperties","castValue_","numProperties","ANGLE","OPACITY","SIZE","STROKE","boolProperties","IS_CIRCLE","IS_RECTANGLE","SHOW_MEASURE","SHOW_LABEL","includes","parts","part","decodeURIComponent","keyVal","val","writeLineStringGeometry_","assertInstanceof","getFlatCoordinates","stride","getStride","encodeCoordinates_","writeMultiLineStringGeometry_","getEnds","lineStringCount","offset","textArray","join","writePointGeometry_","writeMultiPointGeometry_","encodeRings_","linearRingCount","writePolygonGeometry_","writeMultiPolygonGeometry_","getEndss","polygonCount","GEOMETRY_READERS_","GEOMETRY_WRITERS_","opt_flatCoordinates","len","index","b","shift","result","dx","dy","encodedCoordinates","floor","readFeatureFromText","splitIndex","geometryText","readGeometryFromText","olFeature","attributesAndStylesText","attributesText","stylesText","readFeaturesFromText","forEach","property","get","geometryReader","writeFeatureText","encodedParts","encodedGeometry","writeGeometryText","encodedProperties","propFunction","getGeometryName","encoded","replace","toString","apply","styleFunction","getStyleFunction","getType","writeFeaturesText","geometryWriter","transformedGeometry","olFormatFeature"],"mappings":";AAAA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,gBAAQ,oBAAoB;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,yBAAiB,4BAA4B;AAC7C;AACA;AACA,0BAAkB,2BAA2B;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,kDAA0C,gCAAgC;AAC1E;AACA;;AAEA;AACA;AACA;AACA,gEAAwD,kBAAkB;AAC1E;AACA,yDAAiD,cAAc;AAC/D;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAyC,iCAAiC;AAC1E,wHAAgH,mBAAmB,EAAE;AACrI;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;AACA;AACA;AACA,wBAAgB,uBAAuB;AACvC;;;AAGA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;ACnJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAAMA,OAAO,GAAG,EAAhB;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIAA,OAAO,CAACC,MAAR,GAAiBC,OAAO,CAACD,MAAR,CAAe,KAAf,EAAsB,CACrC,SADqC,EAErCE,0DAAa,CAACC,IAFuB,EAGrCC,6DAAgB,CAACD,IAHoB,EAIrCE,mEAAsB,CAACF,IAJc,CAAtB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","file":"permalink.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"permalink\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([31,\"commons\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","/**\n * @module app.permalink\n */\nconst exports = {};\n\nimport './permalink.css';\nimport ngeoFormatFeatureHash from 'ngeo/format/FeatureHash.js';\n\nimport ngeoMapModule from 'ngeo/map/module.js';\nimport ngeoMiscDebounce from 'ngeo/misc/debounce.js';\nimport ngeoMiscDecorate from 'ngeo/misc/decorate.js';\nimport ngeoStatemanagerModule from 'ngeo/statemanager/module.js';\nimport olMap from 'ol/Map.js';\nimport olInteractionDraw from 'ol/interaction/Draw.js';\nimport olLayerTile from 'ol/layer/Tile.js';\nimport olLayerVector from 'ol/layer/Vector.js';\nimport olSourceOSM from 'ol/source/OSM.js';\nimport olSourceVector from 'ol/source/Vector.js';\nimport olStyleStroke from 'ol/style/Stroke.js';\nimport olStyleStyle from 'ol/style/Style.js';\n\n\n/** @type {!angular.IModule} **/\nexports.module = angular.module('app', [\n  'gettext',\n  ngeoMapModule.name,\n  ngeoMiscDebounce.name,\n  ngeoStatemanagerModule.name,\n]);\n\n/**\n * An application-specific map component that updates the URL in the browser\n * address bar when the map view changes. It also sets the initial view based\n * on the URL query params at init time.\n *\n * This component gets a reference to the map instance through the \"app-map\"\n * attribute.\n *\n * @type {!angular.Component}\n */\nexports.mapComponent = {\n  controller: 'AppMapController as ctrl',\n  bindings: {\n    'map': '=appMap'\n  },\n  template: '<div ngeo-map=ctrl.map></div>'\n};\n\n\nexports.module.component('appMap', exports.mapComponent);\n\n\n/**\n * @param {ngeo.statemanager.Location} ngeoLocation ngeo Location service.\n * @param {ngeox.miscDebounce} ngeoDebounce ngeo Debounce factory.\n * @constructor\n * @ngInject\n */\nexports.MapComponentController = function(ngeoLocation, ngeoDebounce) {\n  /**\n   * @type {ol.Map}\n   * @export\n   */\n  this.map;\n\n  /**\n   * @type {ngeo.statemanager.Location}\n   * @private\n   */\n  this.ngeoLocation_ = ngeoLocation;\n\n  /**\n   * @type {ngeox.miscDebounce}\n   * @private\n   */\n  this.ngeoDebounce_ = ngeoDebounce;\n};\n\nexports.module.controller('AppMapController', exports.MapComponentController);\n\nexports.MapComponentController.prototype.$onInit = function() {\n  const view = this.map.getView();\n\n  let zoom = this.ngeoLocation_.getParam('z');\n  zoom = zoom !== undefined ? +zoom : 4;\n\n  const x = this.ngeoLocation_.getParam('x');\n  const y = this.ngeoLocation_.getParam('y');\n  const center = (x !== undefined) && (y !== undefined) ?\n    [+x, +y] : [0, 0];\n\n  view.setCenter(center);\n  view.setZoom(zoom);\n\n  this.ngeoLocation_.updateParams({\n    'z': zoom,\n    'x': Math.round(center[0]),\n    'y': Math.round(center[1])\n  });\n\n  view.on('propertychange',\n    this.ngeoDebounce_(\n      /**\n       * @param {ol.Object.Event} e Object event.\n       */\n      (e) => {\n        const center = view.getCenter();\n        const params = {\n          'z': view.getZoom(),\n          'x': Math.round(center[0]),\n          'y': Math.round(center[1])\n        };\n        this.ngeoLocation_.updateParams(params);\n      }, 300, /* invokeApply */ true));\n};\n\n/**\n * A draw component that adds a simple draw tool.\n *\n * @type {!angular.Component}\n */\nexports.drawComponent = {\n  controller: 'AppDrawController as ctrl',\n  bindings: {\n    'map': '=appDrawMap',\n    'layer': '=appDrawLayer'\n  },\n  template:\n      '<label>Enable drawing:' +\n      '<input type=\"checkbox\" ng-model=\"ctrl.interaction.active\" />' +\n      '</label><br>' +\n      '<button ng-click=\"ctrl.clearLayer()\">Clear layer</button>'\n};\n\n\nexports.module.component('appDraw', exports.drawComponent);\n\n\n/**\n * @param {!angular.IScope} $scope Scope.\n * @param {!ngeo.statemanager.Location} ngeoLocation ngeo Location service.\n * @constructor\n * @export\n * @ngInject\n */\nexports.DrawComponentController = function($scope, ngeoLocation) {\n\n  /**\n   * @type {ol.Map}\n   * @export\n   */\n  this.map;\n\n  /**\n   * @type {ol.layer.Vector}\n   */\n  this.layer;\n\n  /**\n   * @type {!ngeo.statemanager.Location}\n   * @private\n   */\n  this.ngeoLocation_ = ngeoLocation;\n\n  /**\n   * @type {!angular.IScope}\n   * @private\n   */\n  this.scope_ = $scope;\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.featureSeq_ = 0;\n\n  /**\n   * @type {ol.interaction.Draw}\n   * @export\n   */\n  this.interaction;\n};\n\nexports.DrawComponentController.prototype.$onInit = function() {\n  const vectorSource = this.layer.getSource();\n\n  this.interaction = new olInteractionDraw({\n    type: /** @type {ol.geom.GeometryType} */ ('LineString'),\n    source: vectorSource\n  });\n\n  this.interaction.setActive(false);\n  this.map.addInteraction(this.interaction);\n  ngeoMiscDecorate.interaction(this.interaction);\n\n  this.interaction.on('drawend', function(e) {\n    e.feature.set('id', ++this.featureSeq_);\n  }, this);\n\n  // Deal with the encoding and decoding of features in the URL.\n\n  const fhFormat = new ngeoFormatFeatureHash();\n\n  vectorSource.on('addfeature', (e) => {\n    const feature = e.feature;\n    feature.setStyle(new olStyleStyle({\n      stroke: new olStyleStroke({\n        color: [255, 0, 0, 1],\n        width: 2\n      })\n    }));\n    const features = vectorSource.getFeatures();\n    const encodedFeatures = fhFormat.writeFeatures(features);\n    this.scope_.$applyAsync(() => {\n      this.ngeoLocation_.updateParams({'features': encodedFeatures});\n    });\n  });\n\n  const encodedFeatures = this.ngeoLocation_.getParam('features');\n  if (encodedFeatures !== undefined) {\n    const features = fhFormat.readFeatures(encodedFeatures);\n    this.featureSeq_ = features.length;\n    vectorSource.addFeatures(features);\n  }\n};\n\n\n/**\n * Clear the vector layer.\n * @export\n */\nexports.DrawComponentController.prototype.clearLayer = function() {\n  this.layer.getSource().clear(true);\n  this.featureSeq_ = 0;\n  this.ngeoLocation_.deleteParam('features');\n};\n\nexports.module.controller('AppDrawController', exports.DrawComponentController);\n\n\n/**\n * @constructor\n */\nexports.MainController = function() {\n\n  /**\n   * @type {ol.Map}\n   * @export\n   */\n  this.map = new olMap({\n    layers: [\n      new olLayerTile({\n        source: new olSourceOSM()\n      })\n    ]\n  });\n\n\n  const vectorSource = new olSourceVector();\n\n  /**\n   * @type {ol.layer.Vector}\n   * @export\n   */\n  this.vectorLayer = new olLayerVector({\n    source: vectorSource\n  });\n\n  // Use vectorLayer.setMap(map) rather than map.addLayer(vectorLayer). This\n  // makes the vector layer \"unmanaged\", meaning that it is always on top.\n  this.vectorLayer.setMap(this.map);\n\n};\n\n\nexports.module.controller('MainController', exports.MainController);\n\n\nexport default exports;\n","/**\n * @module ngeo.format.FeatureHash\n */\nimport googAsserts from 'goog/asserts.js';\nimport ngeoFormatFeatureProperties from 'ngeo/format/FeatureProperties.js';\nimport ngeoFormatFeatureHashStyleType from 'ngeo/format/FeatureHashStyleType.js';\nimport ngeoUtils from 'ngeo/utils.js';\nimport {inherits as olUtilInherits} from 'ol/util.js';\nimport olFeature from 'ol/Feature.js';\nimport * as olColor from 'ol/color.js';\nimport * as olFormatFeature from 'ol/format/Feature.js';\nimport olFormatTextFeature from 'ol/format/TextFeature.js';\nimport olGeomGeometryLayout from 'ol/geom/GeometryLayout.js';\nimport olGeomLineString from 'ol/geom/LineString.js';\nimport olGeomMultiLineString from 'ol/geom/MultiLineString.js';\nimport olGeomMultiPoint from 'ol/geom/MultiPoint.js';\nimport olGeomMultiPolygon from 'ol/geom/MultiPolygon.js';\nimport olGeomPoint from 'ol/geom/Point.js';\nimport olGeomPolygon from 'ol/geom/Polygon.js';\nimport olStyleCircle from 'ol/style/Circle.js';\nimport olStyleFill from 'ol/style/Fill.js';\nimport olStyleStroke from 'ol/style/Stroke.js';\nimport olStyleStyle from 'ol/style/Style.js';\nimport olStyleText from 'ol/style/Text.js';\n\n/**\n * @classdesc\n * Provide an OpenLayers format for encoding and decoding features for use\n * in permalinks.\n *\n * The code is based on Stphane Brunner's URLCompressed format.\n *\n * TODOs:\n *\n * - The OpenLayers-URLCompressed format has options where the user\n *   can define attribute and style transformers. This is currently\n *   not supported by this format.\n * - The OpenLayers-URLCompressed format has a \"simplify\" option.\n *   This format does not have it.\n * - ol.style.Icon styles are not supported.\n * - Transformation of coordinates during encoding and decoding is\n *   not supported.\n *\n * @see https://github.com/sbrunner/OpenLayers-URLCompressed\n * @constructor\n * @struct\n * @extends {ol.format.TextFeature}\n * @param {ngeox.format.FeatureHashOptions=} opt_options Options.\n */\nconst exports = function(opt_options) {\n\n  olFormatTextFeature.call(this);\n\n  const options = opt_options !== undefined ? opt_options : {};\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.accuracy_ = options.accuracy !== undefined ?\n    options.accuracy : exports.ACCURACY_;\n\n  /**\n   * @type {boolean}\n   * @private\n   */\n  this.encodeStyles_ = options.encodeStyles !== undefined ?\n    options.encodeStyles : true;\n\n  /**\n   * @type {function(ol.Feature):Object.<string, (string|number)>}\n   * @private\n   */\n  this.propertiesFunction_ = options.properties !== undefined ?\n    options.properties : exports.defaultPropertiesFunction_;\n\n  /**\n   * @type {boolean}\n   * @private\n   */\n  this.setStyle_ = options.setStyle !== undefined ? options.setStyle : true;\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.prevX_ = 0;\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.prevY_ = 0;\n\n  /**\n   * @type {Object.<string, string>}\n   * @private\n   */\n  exports.LegacyProperties_ = (options.propertiesType !== undefined) && options.propertiesType;\n\n  /**\n   * @type {Object.<string, function(ol.Feature)>}\n   * @private\n   */\n  this.defaultValues_ = options.defaultValues !== undefined ? options.defaultValues : {};\n\n};\n\nolUtilInherits(exports, olFormatTextFeature);\n\n\n/**\n * @type {Object.<ol.geom.GeometryType, ngeo.format.FeatureHashStyleType>}\n * @private\n */\nexports.StyleTypes_ = {\n  'LineString': ngeoFormatFeatureHashStyleType.LINE_STRING,\n  'Point': ngeoFormatFeatureHashStyleType.POINT,\n  'Polygon': ngeoFormatFeatureHashStyleType.POLYGON,\n  'MultiLineString': ngeoFormatFeatureHashStyleType.LINE_STRING,\n  'MultiPoint': ngeoFormatFeatureHashStyleType.POINT,\n  'MultiPolygon': ngeoFormatFeatureHashStyleType.POLYGON\n};\n\n/**\n * @type {Object.<string, string>}\n * @private\n */\nexports.LegacyProperties_ = {};\n\n\n/**\n * @inheritDoc\n */\nexports.prototype.readFeature;\n\n\n/**\n * @inheritDoc\n */\nexports.prototype.readFeatures;\n\n\n/**\n * @inheritDoc\n */\nexports.prototype.readGeometry;\n\n\n/**\n * @inheritDoc\n */\nexports.prototype.writeFeature;\n\n\n/**\n * @inheritDoc\n */\nexports.prototype.writeFeatures;\n\n\n/**\n * @inheritDoc\n */\nexports.prototype.writeGeometry;\n\n\n/**\n * Characters used to encode the coordinates. The characters \"~\", \"'\", \"(\"\n * and \")\" are not part of this character set, and used as separators (for\n * example to separate the coordinates from the feature properties).\n * @const\n * @private\n */\nexports.CHAR64_ =\n    '.-_!*ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghjkmnpqrstuvwxyz';\n\n\n/**\n * @const\n * @private\n */\nexports.ACCURACY_ = 0.1;\n\n\n/**\n * Get features's properties.\n * @param {ol.Feature} feature Feature.\n * @return {Object.<string, (string|number)>} The feature properties to\n * serialize.\n * @private\n */\nexports.defaultPropertiesFunction_ = function(feature) {\n  return feature.getProperties();\n};\n\n\n/**\n * Sign then encode a number.\n * @param {number} num Number.\n * @return {string} String.\n * @private\n */\nexports.encodeSignedNumber_ = function(num) {\n  let signedNum = num << 1;\n  if (num < 0) {\n    signedNum = ~(signedNum);\n  }\n  return exports.encodeNumber_(signedNum);\n};\n\n\n/**\n * Transform a number into a logical sequence of characters.\n * @param {number} num Number.\n * @return {string} String.\n * @private\n */\nexports.encodeNumber_ = function(num) {\n  let encodedNumber = '';\n  while (num >= 0x20) {\n    encodedNumber += exports.CHAR64_.charAt(\n      0x20 | (num & 0x1f));\n    num >>= 5;\n  }\n  encodedNumber += exports.CHAR64_.charAt(num);\n  return encodedNumber;\n};\n\n\n/**\n * For a type of geometry, transforms an array of {@link ol.style.Style} into\n * a logical sequence of characters and put the result into the given encoded\n * styles's array.\n * @param {Array.<ol.style.Style>} styles Styles.\n * @param {ol.geom.GeometryType} geometryType Geometry type.\n * @param {Array.<string>} encodedStyles Encoded styles array.\n * @private\n */\nexports.encodeStyles_ = function(styles, geometryType, encodedStyles) {\n  const styleType = exports.StyleTypes_[geometryType];\n  googAsserts.assert(styleType !== undefined);\n  for (let i = 0; i < styles.length; ++i) {\n    const style = styles[i];\n    const fillStyle = style.getFill();\n    const imageStyle = style.getImage();\n    const strokeStyle = style.getStroke();\n    const textStyle = style.getText();\n    if (styleType == ngeoFormatFeatureHashStyleType.POLYGON) {\n      if (fillStyle !== null) {\n        exports.encodeStylePolygon_(\n          fillStyle, strokeStyle, encodedStyles);\n      }\n    } else if (styleType == ngeoFormatFeatureHashStyleType.LINE_STRING) {\n      if (strokeStyle !== null) {\n        exports.encodeStyleLine_(strokeStyle, encodedStyles);\n      }\n    } else if (styleType == ngeoFormatFeatureHashStyleType.POINT) {\n      if (imageStyle !== null) {\n        exports.encodeStylePoint_(imageStyle, encodedStyles);\n      }\n    }\n    if (textStyle !== null) {\n      exports.encodeStyleText_(textStyle, encodedStyles);\n    }\n  }\n};\n\n\n/**\n * Transform an {@link ol.style.Stroke} into a logical sequence of\n * characters and put the result into the given encoded styles's array.\n * @param {ol.style.Stroke} strokeStyle Stroke style.\n * @param {Array.<string>} encodedStyles Encoded styles array.\n * @private\n */\nexports.encodeStyleLine_ = function(strokeStyle, encodedStyles) {\n  exports.encodeStyleStroke_(strokeStyle, encodedStyles);\n};\n\n\n/**\n * Transform an {@link ol.style.Circle} into a logical sequence of\n * characters and put the result into the given encoded styles's array.\n * @param {ol.style.Image} imageStyle Image style.\n * @param {Array.<string>} encodedStyles Encoded styles array.\n * @private\n */\nexports.encodeStylePoint_ = function(imageStyle, encodedStyles) {\n  if (imageStyle instanceof olStyleCircle) {\n    const radius = imageStyle.getRadius();\n    if (encodedStyles.length > 0) {\n      encodedStyles.push('\\'');\n    }\n    encodedStyles.push(encodeURIComponent(`pointRadius*${radius}`));\n    const fillStyle = imageStyle.getFill();\n    if (fillStyle !== null) {\n      exports.encodeStyleFill_(fillStyle, encodedStyles);\n    }\n    const strokeStyle = imageStyle.getStroke();\n    if (strokeStyle !== null) {\n      exports.encodeStyleStroke_(strokeStyle, encodedStyles);\n    }\n  }\n};\n\n\n/**\n * Transform an {@link ol.style.Fill} and an {@link ol.style.Stroke} into\n * a logical sequence of characters and put the result into the given\n * encoded styles's array.\n * @param {ol.style.Fill} fillStyle Fill style.\n * @param {ol.style.Stroke} strokeStyle Stroke style.\n * @param {Array.<string>} encodedStyles Encoded styles array.\n * @private\n */\nexports.encodeStylePolygon_ = function(fillStyle, strokeStyle, encodedStyles) {\n  exports.encodeStyleFill_(fillStyle, encodedStyles);\n  if (strokeStyle !== null) {\n    exports.encodeStyleStroke_(strokeStyle, encodedStyles);\n  }\n};\n\n\n/**\n * Transform an {@link ol.style.Fill} and optionally its properties into\n * a logical sequence of characters and put the result into the given encoded\n * styles's array.\n * @param {ol.style.Fill} fillStyle Fill style.\n * @param {Array.<string>} encodedStyles Encoded styles array.\n * @param {string=} opt_propertyName Property name.\n * @private\n */\nexports.encodeStyleFill_ = function(fillStyle, encodedStyles, opt_propertyName) {\n  const propertyName = opt_propertyName !== undefined ?\n    opt_propertyName : 'fillColor';\n  const fillColor = fillStyle.getColor();\n  if (fillColor !== null) {\n    googAsserts.assert(Array.isArray(fillColor), 'only supporting fill colors');\n    const fillColorRgba = olColor.asArray(fillColor);\n    googAsserts.assert(Array.isArray(fillColorRgba), 'fill color must be an array');\n    const fillColorHex = ngeoUtils.rgbArrayToHex(fillColorRgba);\n    if (encodedStyles.length > 0) {\n      encodedStyles.push('\\'');\n    }\n    encodedStyles.push(\n      encodeURIComponent(`${propertyName}*${fillColorHex}`));\n  }\n};\n\n\n/**\n * Transform an {@link ol.style.Stroke} into a logical sequence of\n * characters and put the result into the given encoded styles's array.\n * @param {ol.style.Stroke} strokeStyle Stroke style.\n * @param {Array.<string>} encodedStyles Encoded styles array.\n * @private\n */\nexports.encodeStyleStroke_ = function(strokeStyle, encodedStyles) {\n  const strokeColor = strokeStyle.getColor();\n  if (strokeColor !== null) {\n    googAsserts.assert(Array.isArray(strokeColor));\n    const strokeColorRgba = olColor.asArray(strokeColor);\n    googAsserts.assert(Array.isArray(strokeColorRgba), 'only supporting stroke colors');\n    const strokeColorHex = ngeoUtils.rgbArrayToHex(strokeColorRgba);\n    if (encodedStyles.length > 0) {\n      encodedStyles.push('\\'');\n    }\n    encodedStyles.push(encodeURIComponent(`strokeColor*${strokeColorHex}`));\n  }\n  const strokeWidth = strokeStyle.getWidth();\n  if (strokeWidth !== undefined) {\n    if (encodedStyles.length > 0) {\n      encodedStyles.push('\\'');\n    }\n    encodedStyles.push(encodeURIComponent(`strokeWidth*${strokeWidth}`));\n  }\n};\n\n\n/**\n * Transform an {@link ol.style.Text} into a logical sequence of characters and\n * put the result into the given encoded styles's array.\n * @param {ol.style.Text} textStyle Text style.\n * @param {Array.<string>} encodedStyles Encoded styles array.\n * @private\n */\nexports.encodeStyleText_ = function(textStyle, encodedStyles) {\n  const fontStyle = textStyle.getFont();\n  if (fontStyle !== undefined) {\n    const font = fontStyle.split(' ');\n    if (font.length >= 3) {\n      if (encodedStyles.length > 0) {\n        encodedStyles.push('\\'');\n      }\n      encodedStyles.push(encodeURIComponent(`fontSize*${font[1]}`));\n    }\n  }\n  const fillStyle = textStyle.getFill();\n  if (fillStyle !== null) {\n    exports.encodeStyleFill_(\n      fillStyle, encodedStyles, 'fontColor');\n  }\n};\n\n\n/**\n * Read a logical sequence of characters and return a corresponding\n * {@link ol.geom.LineString}.\n * @param {string} text Text.\n * @return {ol.geom.LineString} Line string.\n * @this {ngeo.format.FeatureHash}\n * @private\n */\nexports.readLineStringGeometry_ = function(text) {\n  googAsserts.assert(text.substring(0, 2) === 'l(');\n  googAsserts.assert(text[text.length - 1] == ')');\n  text = text.substring(2, text.length - 1);\n  const flatCoordinates = this.decodeCoordinates_(text);\n  return new olGeomLineString(flatCoordinates, olGeomGeometryLayout.XY);\n};\n\n\n/**\n * Read a logical sequence of characters and return a corresponding\n * {@link ol.geom.MultiLineString}.\n * @param {string} text Text.\n * @return {ol.geom.MultiLineString} Line string.\n * @this {ngeo.format.FeatureHash}\n * @private\n */\nexports.readMultiLineStringGeometry_ = function(text) {\n  googAsserts.assert(text.substring(0, 2) === 'L(');\n  googAsserts.assert(text[text.length - 1] == ')');\n  text = text.substring(2, text.length - 1);\n  let flatCoordinates = [];\n  const ends = [];\n  const lineStrings = text.split('\\'');\n  for (let i = 0, ii = lineStrings.length; i < ii; ++i) {\n    flatCoordinates = this.decodeCoordinates_(lineStrings[i], flatCoordinates);\n    ends[i] = flatCoordinates.length;\n  }\n  return new olGeomMultiLineString(flatCoordinates, olGeomGeometryLayout.XY, ends);\n};\n\n\n/**\n * Read a logical sequence of characters and return a corresponding\n * {@link ol.geom.Point}.\n * @param {string} text Text.\n * @return {ol.geom.Point} Point.\n * @this {ngeo.format.FeatureHash}\n * @private\n */\nexports.readPointGeometry_ = function(text) {\n  googAsserts.assert(text.substring(0, 2) === 'p(');\n  googAsserts.assert(text[text.length - 1] == ')');\n  text = text.substring(2, text.length - 1);\n  const flatCoordinates = this.decodeCoordinates_(text);\n  googAsserts.assert(flatCoordinates.length === 2);\n  return new olGeomPoint(flatCoordinates, olGeomGeometryLayout.XY);\n};\n\n\n/**\n * Read a logical sequence of characters and return a corresponding\n * {@link ol.geom.MultiPoint}.\n * @param {string} text Text.\n * @return {ol.geom.MultiPoint} MultiPoint.\n * @this {ngeo.format.FeatureHash}\n * @private\n */\nexports.readMultiPointGeometry_ = function(text) {\n  googAsserts.assert(text.substring(0, 2) === 'P(');\n  googAsserts.assert(text[text.length - 1] == ')');\n  text = text.substring(2, text.length - 1);\n  const flatCoordinates = this.decodeCoordinates_(text);\n  return new olGeomMultiPoint(flatCoordinates, olGeomGeometryLayout.XY);\n};\n\n\n/**\n * Read a logical sequence of characters and return a corresponding\n * {@link ol.geom.Polygon}.\n * @param {string} text Text.\n * @return {ol.geom.Polygon} Polygon.\n * @this {ngeo.format.FeatureHash}\n * @private\n */\nexports.readPolygonGeometry_ = function(text) {\n  googAsserts.assert(text.substring(0, 2) === 'a(');\n  googAsserts.assert(text[text.length - 1] == ')');\n  text = text.substring(2, text.length - 1);\n  let flatCoordinates = [];\n  const ends = [];\n  const rings = text.split('\\'');\n  for (let i = 0, ii = rings.length; i < ii; ++i) {\n    flatCoordinates = this.decodeCoordinates_(rings[i], flatCoordinates);\n    let end = flatCoordinates.length;\n    if (i === 0) {\n      flatCoordinates[end++] = flatCoordinates[0];\n      flatCoordinates[end++] = flatCoordinates[1];\n    } else {\n      flatCoordinates[end++] = flatCoordinates[ends[i - 1]];\n      flatCoordinates[end++] = flatCoordinates[ends[i - 1] + 1];\n    }\n    ends[i] = end;\n  }\n  return new olGeomPolygon(flatCoordinates, olGeomGeometryLayout.XY, ends);\n};\n\n\n/**\n * Read a logical sequence of characters and return a corresponding\n * {@link ol.geom.MultiPolygon}.\n * @param {string} text Text.\n * @return {ol.geom.MultiPolygon} MultiPolygon.\n * @this {ngeo.format.FeatureHash}\n * @private\n */\nexports.readMultiPolygonGeometry_ = function(text) {\n  googAsserts.assert(text.substring(0, 2) === 'A(');\n  googAsserts.assert(text[text.length - 1] == ')');\n  text = text.substring(2, text.length - 1);\n  let flatCoordinates = [];\n  const endss = [];\n  const polygons = text.split(')(');\n  for (let i = 0, ii = polygons.length; i < ii; ++i) {\n    const rings = polygons[i].split('\\'');\n    const ends = endss[i] = [];\n    for (let j = 0, jj = rings.length; j < jj; ++j) {\n      flatCoordinates = this.decodeCoordinates_(rings[j], flatCoordinates);\n      let end = flatCoordinates.length;\n      if (j === 0) {\n        flatCoordinates[end++] = flatCoordinates[0];\n        flatCoordinates[end++] = flatCoordinates[1];\n      } else {\n        flatCoordinates[end++] = flatCoordinates[ends[j - 1]];\n        flatCoordinates[end++] = flatCoordinates[ends[j - 1] + 1];\n      }\n      ends[j] = end;\n    }\n  }\n  return new olGeomMultiPolygon(flatCoordinates, olGeomGeometryLayout.XY, endss);\n};\n\n\n/**\n * DEPRECATED - Use the `ngeo.misc.FeatureHelper` instead in combination with the\n * `setStyle: false` option.\n *\n * Read a logical sequence of characters and apply the decoded style on the\n * given feature.\n * @param {string} text Text.\n * @param {ol.Feature} feature Feature.\n * @private\n */\nexports.setStyleInFeature_ = function(text, feature) {\n  if (text == '') {\n    return;\n  }\n  const properties = exports.getStyleProperties_(text, feature);\n  const fillColor = properties['fillColor'];\n  const fontSize = properties['fontSize'];\n  const fontColor = properties['fontColor'];\n  const pointRadius = properties['pointRadius'];\n  const strokeColor = properties['strokeColor'];\n  const strokeWidth = properties['strokeWidth'];\n\n  let fillStyle = null;\n  if (fillColor !== undefined) {\n    fillStyle = new olStyleFill({\n      color: /** @type {Array<number>|string} */ (fillColor)\n    });\n  }\n  let strokeStyle = null;\n  if (strokeColor !== undefined && strokeWidth !== undefined) {\n    strokeStyle = new olStyleStroke({\n      color: /** @type {Array<number>|string} */ (strokeColor),\n      width: /** @type {number} */ (strokeWidth)\n    });\n  }\n  let imageStyle = null;\n  if (pointRadius !== undefined) {\n    imageStyle = new olStyleCircle({\n      radius: /** @type {number} */ (pointRadius),\n      fill: fillStyle,\n      stroke: strokeStyle\n    });\n    fillStyle = strokeStyle = null;\n  }\n  let textStyle = null;\n  if (fontSize !== undefined && fontColor !== undefined) {\n    textStyle = new olStyleText({\n      font: `${fontSize} sans-serif`,\n      fill: new olStyleFill({\n        color: /** @type {Array<number>|string} */ (fontColor)\n      })\n    });\n  }\n  const style = new olStyleStyle({\n    fill: fillStyle,\n    image: imageStyle,\n    stroke: strokeStyle,\n    text: textStyle\n  });\n  feature.setStyle(style);\n};\n\n\n/**\n * Read a logical sequence of characters and apply the decoded result as\n * style properties for the feature. Legacy keys are converted to the new ones\n * for compatibility.\n * @param {string} text Text.\n * @param {ol.Feature} feature Feature.\n * @private\n */\nexports.setStyleProperties_ = function(text, feature) {\n\n  const properties = exports.getStyleProperties_(text, feature);\n  const geometry = feature.getGeometry();\n\n  // Deal with legacy properties\n  if (geometry instanceof olGeomPoint) {\n    if (properties['isLabel'] ||\n        properties[ngeoFormatFeatureProperties.IS_TEXT]) {\n      delete properties['strokeColor'];\n      delete properties['fillColor'];\n    } else {\n      delete properties['fontColor'];\n      delete properties['fontSize'];\n    }\n  } else {\n    delete properties['fontColor'];\n\n    if (geometry instanceof olGeomLineString) {\n      delete properties['fillColor'];\n      delete properties['fillOpacity'];\n    }\n  }\n\n  // Convert font size from px to pt\n  if (properties['fontSize']) {\n    let fontSize = parseFloat(properties['fontSize']);\n    if (properties['fontSize'].indexOf('px') !== -1) {\n      fontSize = Math.round(fontSize / 1.333333);\n    }\n    properties['fontSize'] = fontSize;\n  }\n\n  // Convert legacy properties\n  const clone = {};\n  for (const key in properties) {\n    const value = properties[key];\n    if (exports.LegacyProperties_[key]) {\n      clone[exports.LegacyProperties_[key]] = value;\n    } else {\n      clone[key] = value;\n    }\n  }\n\n  feature.setProperties(clone);\n};\n\n\n/**\n * Cast values in the correct type depending on the property.\n * @param {string} key Key.\n * @param {string} value Value.\n * @return {number|boolean|string} The casted value corresponding to the key.\n * @private\n */\nexports.castValue_ = function(key, value) {\n  const numProperties = [\n    ngeoFormatFeatureProperties.ANGLE,\n    ngeoFormatFeatureProperties.OPACITY,\n    ngeoFormatFeatureProperties.SIZE,\n    ngeoFormatFeatureProperties.STROKE,\n    'pointRadius',\n    'strokeWidth'\n  ];\n  const boolProperties = [\n    ngeoFormatFeatureProperties.IS_CIRCLE,\n    ngeoFormatFeatureProperties.IS_RECTANGLE,\n    ngeoFormatFeatureProperties.IS_TEXT,\n    ngeoFormatFeatureProperties.SHOW_MEASURE,\n    ngeoFormatFeatureProperties.SHOW_LABEL,\n    'isCircle',\n    'isRectangle',\n    'isLabel',\n    'showMeasure',\n    'showLabel'\n  ];\n\n  if (numProperties.includes(key)) {\n    return +value;\n  } else if (boolProperties.includes(key)) {\n    return (value === 'true') ? true : false;\n  } else {\n    return value;\n  }\n};\n\n\n/**\n * From a logical sequence of characters, create and return an object of\n * style properties for a feature. The values are cast in the correct type\n * depending on the property. Some properties are also deleted when they don't\n * match the geometry of the feature.\n * @param {string} text Text.\n * @param {ol.Feature} feature Feature.\n * @return {Object.<string, boolean|number|string>} The style properties for\n *     the feature.\n * @private\n */\nexports.getStyleProperties_ = function(text, feature) {\n  const parts = text.split('\\'');\n  const properties = {};\n\n  for (let i = 0; i < parts.length; ++i) {\n    const part = decodeURIComponent(parts[i]);\n    const keyVal = part.split('*');\n    googAsserts.assert(keyVal.length === 2);\n    const key = keyVal[0];\n    const val = keyVal[1];\n\n    properties[key] = exports.castValue_(key, val);\n  }\n\n  return properties;\n};\n\n\n/**\n * Encode a {@link ol.geom.LineString} geometry into a logical sequence of\n * characters.\n * @param {ol.geom.Geometry} geometry Geometry.\n * @return {string} Encoded geometry.\n * @this {ngeo.format.FeatureHash}\n * @private\n */\nexports.writeLineStringGeometry_ = function(geometry) {\n  googAsserts.assertInstanceof(geometry, olGeomLineString);\n  const flatCoordinates = geometry.getFlatCoordinates();\n  const stride = geometry.getStride();\n  const end = flatCoordinates.length;\n  return `l(${this.encodeCoordinates_(flatCoordinates, stride, 0, end)})`;\n};\n\n\n/**\n * Encode a {@link ol.geom.MultiLineString} geometry into a logical sequence\n * of characters.\n * @param {ol.geom.Geometry} geometry Geometry.\n * @return {string} Encoded geometry.\n * @this {ngeo.format.FeatureHash}\n * @private\n */\nexports.writeMultiLineStringGeometry_ = function(geometry) {\n  googAsserts.assertInstanceof(geometry, olGeomMultiLineString);\n  const ends = geometry.getEnds();\n  const lineStringCount = ends.length;\n  const flatCoordinates = geometry.getFlatCoordinates();\n  const stride = geometry.getStride();\n  let offset = 0;\n  const textArray = ['L('];\n  for (let i = 0; i < lineStringCount; ++i) {\n    const end = ends[i];\n    const text = this.encodeCoordinates_(flatCoordinates, stride, offset, end);\n    if (i !== 0) {\n      textArray.push('\\'');\n    }\n    textArray.push(text);\n    offset = end;\n  }\n  textArray.push(')');\n  return textArray.join('');\n};\n\n\n/**\n * Encode a {@link ol.geom.Point} geometry into a logical sequence of\n * characters.\n * @param {ol.geom.Geometry} geometry Geometry.\n * @return {string} Encoded geometry.\n * @this {ngeo.format.FeatureHash}\n * @private\n */\nexports.writePointGeometry_ = function(geometry) {\n  googAsserts.assertInstanceof(geometry, olGeomPoint);\n  const flatCoordinates = geometry.getFlatCoordinates();\n  const stride = geometry.getStride();\n  const end = flatCoordinates.length;\n  return `p(${this.encodeCoordinates_(flatCoordinates, stride, 0, end)})`;\n};\n\n\n/**\n * Encode an {@link ol.geom.MultiPoint} geometry into a logical sequence\n * of characters.\n * @param {ol.geom.Geometry} geometry Geometry.\n * @return {string} Encoded geometry.\n * @this {ngeo.format.FeatureHash}\n * @private\n */\nexports.writeMultiPointGeometry_ = function(geometry) {\n  googAsserts.assertInstanceof(geometry, olGeomMultiPoint);\n  const flatCoordinates = geometry.getFlatCoordinates();\n  const stride = geometry.getStride();\n  const end = flatCoordinates.length;\n  return `P(${this.encodeCoordinates_(flatCoordinates, stride, 0, end)})`;\n};\n\n\n/**\n * Helper to encode an {@link ol.geom.Polygon} geometry.\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} stride Stride.\n * @param {number} offset Offset.\n * @param {Array.<number>} ends Ends.\n * @param {Array.<string>} textArray Text array.\n * @return {number} The new offset.\n * @this {ngeo.format.FeatureHash}\n * @private\n */\nexports.encodeRings_ = function(flatCoordinates, stride, offset, ends, textArray) {\n  const linearRingCount = ends.length;\n  for (let i = 0; i < linearRingCount; ++i) {\n    // skip the \"closing\" point\n    const end = ends[i] - stride;\n    const text = this.encodeCoordinates_(flatCoordinates, stride, offset, end);\n    if (i !== 0) {\n      textArray.push('\\'');\n    }\n    textArray.push(text);\n    offset = ends[i];\n  }\n  return offset;\n};\n\n\n/**\n * Encode an {@link ol.geom.Polygon} geometry into a logical sequence\n * of characters.\n * @param {ol.geom.Geometry} geometry Geometry.\n * @return {string} Encoded geometry.\n * @this {ngeo.format.FeatureHash}\n * @private\n */\nexports.writePolygonGeometry_ = function(geometry) {\n  googAsserts.assertInstanceof(geometry, olGeomPolygon);\n  const flatCoordinates = geometry.getFlatCoordinates();\n  const stride = geometry.getStride();\n  const ends = geometry.getEnds();\n  const offset = 0;\n  const textArray = ['a('];\n  exports.encodeRings_.call(this,\n    flatCoordinates, stride, offset, ends, textArray);\n  textArray.push(')');\n  return textArray.join('');\n};\n\n\n/**\n * Encode an {@link ol.geom.MultiPoligon} geometry into a logical sequence of\n * characters.\n * @param {ol.geom.Geometry} geometry Geometry.\n * @return {string} Encoded geometry.\n * @this {ngeo.format.FeatureHash}\n * @private\n */\nexports.writeMultiPolygonGeometry_ = function(geometry) {\n  googAsserts.assertInstanceof(geometry, olGeomMultiPolygon);\n  const flatCoordinates = geometry.getFlatCoordinates();\n  const stride = geometry.getStride();\n  const endss = geometry.getEndss();\n  const polygonCount = endss.length;\n  let offset = 0;\n  const textArray = ['A'];\n  for (let i = 0; i < polygonCount; ++i) {\n    const ends = endss[i];\n    textArray.push('(');\n    offset = exports.encodeRings_.call(this,\n      flatCoordinates, stride, offset, ends, textArray);\n    textArray.push(')');\n  }\n  return textArray.join('');\n};\n\n\n/**\n * @const\n * @private\n * @type {Object.<string, function(string):ol.geom.Geometry>}\n */\nexports.GEOMETRY_READERS_ = {\n  'P': exports.readMultiPointGeometry_,\n  'L': exports.readMultiLineStringGeometry_,\n  'A': exports.readMultiPolygonGeometry_,\n  'l': exports.readLineStringGeometry_,\n  'p': exports.readPointGeometry_,\n  'a': exports.readPolygonGeometry_\n};\n\n\n/**\n * @const\n * @private\n * @type {Object.<string, function(ol.geom.Geometry):string>}\n */\nexports.GEOMETRY_WRITERS_ = {\n  'MultiLineString': exports.writeMultiLineStringGeometry_,\n  'MultiPoint': exports.writeMultiPointGeometry_,\n  'MultiPolygon': exports.writeMultiPolygonGeometry_,\n  'LineString': exports.writeLineStringGeometry_,\n  'Point': exports.writePointGeometry_,\n  'Polygon': exports.writePolygonGeometry_\n};\n\n\n/**\n * Read a logical sequence of characters and return (or complete then return)\n * an array of numbers. The coordinates are assumed to be in\n * two dimensions and in latitude, longitude order.\n * corresponding to a geometry's coordinates.\n * @param {string} text Text.\n * @param {Array.<number>=} opt_flatCoordinates Flat coordinates array.\n * @return {Array.<number>} Flat coordinates.\n * @private\n */\nexports.prototype.decodeCoordinates_ = function(text, opt_flatCoordinates) {\n  const len = text.length;\n  let index = 0;\n  const flatCoordinates = opt_flatCoordinates !== undefined ?\n    opt_flatCoordinates : [];\n  let i = flatCoordinates.length;\n  while (index < len) {\n    let b;\n    let shift = 0;\n    let result = 0;\n    do {\n      b = exports.CHAR64_.indexOf(text.charAt(index++));\n      result |= (b & 0x1f) << shift;\n      shift += 5;\n    } while (b >= 32);\n    const dx = ((result & 1) ? ~(result >> 1) : (result >> 1));\n    this.prevX_ += dx;\n    shift = 0;\n    result = 0;\n    do {\n      b = exports.CHAR64_.indexOf(text.charAt(index++));\n      result |= (b & 0x1f) << shift;\n      shift += 5;\n    } while (b >= 32);\n    const dy = ((result & 1) ? ~(result >> 1) : (result >> 1));\n    this.prevY_ += dy;\n    flatCoordinates[i++] = this.prevX_ * this.accuracy_;\n    flatCoordinates[i++] = this.prevY_ * this.accuracy_;\n  }\n  return flatCoordinates;\n};\n\n\n/**\n * Encode an array of number (corresponding to some coordinates) into a\n * logical sequence of characters. The coordinates are assumed to be in\n * two dimensions and in latitude, longitude order.\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} stride Stride.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @return {string} String.\n * @private\n */\nexports.prototype.encodeCoordinates_ = function(flatCoordinates, stride, offset, end) {\n  let encodedCoordinates = '';\n  for (let i = offset; i < end; i += stride) {\n    let x = flatCoordinates[i];\n    let y = flatCoordinates[i + 1];\n    x = Math.floor(x / this.accuracy_);\n    y = Math.floor(y / this.accuracy_);\n    const dx = x - this.prevX_;\n    const dy = y - this.prevY_;\n    this.prevX_ = x;\n    this.prevY_ = y;\n    encodedCoordinates += exports.encodeSignedNumber_(dx) +\n        exports.encodeSignedNumber_(dy);\n  }\n  return encodedCoordinates;\n};\n\n\n/**\n * Read a feature from a logical sequence of characters.\n * @param {string} text Text.\n * @param {olx.format.ReadOptions=} opt_options Read options.\n * @return {ol.Feature} Feature.\n * @protected\n * @override\n */\nexports.prototype.readFeatureFromText = function(text, opt_options) {\n  googAsserts.assert(text.length > 2);\n  googAsserts.assert(text[1] === '(');\n  googAsserts.assert(text[text.length - 1] === ')');\n  let splitIndex = text.indexOf('~');\n  const geometryText = splitIndex >= 0 ?\n    `${text.substring(0, splitIndex)})` : text;\n  const geometry = this.readGeometryFromText(geometryText, opt_options);\n  const feature = new olFeature(geometry);\n  if (splitIndex >= 0) {\n    const attributesAndStylesText = text.substring(\n      splitIndex + 1, text.length - 1);\n    splitIndex = attributesAndStylesText.indexOf('~');\n    const attributesText = splitIndex >= 0 ?\n      attributesAndStylesText.substring(0, splitIndex) :\n      attributesAndStylesText;\n    if (attributesText != '') {\n      const parts = attributesText.split('\\'');\n      for (let i = 0; i < parts.length; ++i) {\n        const part = decodeURIComponent(parts[i]);\n        const keyVal = part.split('*');\n        googAsserts.assert(keyVal.length === 2);\n        let key = keyVal[0];\n        const value = keyVal[1];\n        if (!this.setStyle_ && exports.LegacyProperties_[key]) {\n          key = exports.LegacyProperties_[key];\n        }\n        feature.set(key, exports.castValue_(key, value));\n      }\n    }\n    if (splitIndex >= 0) {\n      const stylesText = attributesAndStylesText.substring(splitIndex + 1);\n      if (this.setStyle_) {\n        exports.setStyleInFeature_(stylesText, feature);\n      } else {\n        exports.setStyleProperties_(stylesText, feature);\n      }\n    }\n  }\n  return feature;\n};\n\n\n/**\n * Read multiple features from a logical sequence of characters.\n * @param {string} text Text.\n * @param {olx.format.ReadOptions=} opt_options Read options.\n * @return {Array.<ol.Feature>} Features.\n * @protected\n * @override\n */\nexports.prototype.readFeaturesFromText = function(text, opt_options) {\n  googAsserts.assert(text[0] === 'F');\n  this.prevX_ = 0;\n  this.prevY_ = 0;\n  /** @type {Array.<ol.Feature>} */\n  const features = [];\n  text = text.substring(1);\n  while (text.length > 0) {\n    const index = text.indexOf(')');\n    googAsserts.assert(index >= 0);\n    const feature = this.readFeatureFromText(\n      text.substring(0, index + 1), opt_options);\n    features.push(feature);\n    text = text.substring(index + 1);\n  }\n\n  // set default values\n  features.forEach((feature) => {\n    for (const key in this.defaultValues_) {\n      const property = exports.LegacyProperties_[key];\n      if (feature.get(property) === undefined) {\n        feature.set(property, this.defaultValues_[key].call(null, feature));\n      }\n    }\n  });\n  return features;\n};\n\n\n/**\n * Read a geometry from a logical sequence of characters.\n * @param {string} text Text.\n * @param {olx.format.ReadOptions=} opt_options Read options.\n * @return {ol.geom.Geometry} Geometry.\n * @protected\n * @override\n */\nexports.prototype.readGeometryFromText = function(text, opt_options) {\n  const geometryReader = exports.GEOMETRY_READERS_[text[0]];\n  googAsserts.assert(geometryReader !== undefined);\n  return geometryReader.call(this, text);\n};\n\n\n/**\n * Encode a feature into a logical sequence of characters.\n * @param {ol.Feature} feature Feature.\n * @param {olx.format.ReadOptions=} opt_options Read options.\n * @return {string} Encoded feature.\n * @protected\n * @override\n */\nexports.prototype.writeFeatureText = function(feature, opt_options) {\n  const /** @type {Array.<string>} */ encodedParts = [];\n\n  // encode geometry\n\n  let encodedGeometry = '';\n  const geometry = feature.getGeometry();\n  if (geometry) {\n    encodedGeometry = this.writeGeometryText(geometry, opt_options);\n  }\n\n  if (encodedGeometry.length > 0) {\n    // remove the final bracket\n    googAsserts.assert(encodedGeometry[encodedGeometry.length - 1] === ')');\n    encodedGeometry = encodedGeometry.substring(0, encodedGeometry.length - 1);\n    encodedParts.push(encodedGeometry);\n  }\n\n  // encode properties\n\n  const /** @type {Array.<string>} */ encodedProperties = [];\n  const propFunction = this.propertiesFunction_(feature);\n  for (const key in propFunction) {\n    const value = propFunction[key];\n    if (value !== undefined && value !== null && key !== feature.getGeometryName()) {\n      if (encodedProperties.length !== 0) {\n        encodedProperties.push('\\'');\n      }\n      const encoded = encodeURIComponent(\n        `${key.replace(/[()'*]/g, '_')}*${\n          value.toString().replace(/[()'*]/g, '_')}`);\n      encodedProperties.push(encoded);\n    }\n  }\n\n  if (encodedProperties.length > 0) {\n    encodedParts.push('~');\n    Array.prototype.push.apply(encodedParts, encodedProperties);\n  }\n\n  // encode styles\n\n  if (this.encodeStyles_) {\n    const styleFunction = feature.getStyleFunction();\n    if (styleFunction !== undefined) {\n      let styles = styleFunction.call(feature, 0);\n      if (styles !== null) {\n        const encodedStyles = [];\n        styles = Array.isArray(styles) ? styles : [styles];\n        exports.encodeStyles_(\n          styles, geometry.getType(), encodedStyles);\n        if (encodedStyles.length > 0) {\n          encodedParts.push('~');\n          Array.prototype.push.apply(encodedParts, encodedStyles);\n        }\n      }\n    }\n  }\n\n  // append the closing bracket and return the encoded feature\n\n  encodedParts.push(')');\n  return encodedParts.join('');\n};\n\n\n/**\n * Encode an array of features into a logical sequence of characters.\n * @param {Array.<ol.Feature>} features Feature.\n * @param {olx.format.ReadOptions=} opt_options Read options.\n * @return {string} Encoded features.\n * @protected\n * @override\n */\nexports.prototype.writeFeaturesText = function(features, opt_options) {\n  this.prevX_ = 0;\n  this.prevY_ = 0;\n  const textArray = [];\n  if (features.length > 0) {\n    textArray.push('F');\n    for (let i = 0, ii = features.length; i < ii; ++i) {\n      textArray.push(this.writeFeatureText(features[i], opt_options));\n    }\n  }\n  return textArray.join('');\n};\n\n\n/**\n * Encode a geometry into a logical sequence of characters.\n * @param {ol.geom.Geometry} geometry Geometry.\n * @param {olx.format.ReadOptions=} opt_options Read options.\n * @return {string} Encoded geometry.\n * @protected\n * @override\n */\nexports.prototype.writeGeometryText = function(geometry, opt_options) {\n  const geometryWriter = exports.GEOMETRY_WRITERS_[\n    geometry.getType()];\n  googAsserts.assert(geometryWriter !== undefined);\n  const transformedGeometry = /** @type {ol.geom.Geometry} */\n      (olFormatFeature.transformWithOptions(geometry, true, opt_options));\n  return geometryWriter.call(this, transformedGeometry);\n};\n\n\nexport default exports;\n","/**\n * @module ngeo.format.FeatureHashStyleType\n */\n/**\n * @enum {string}\n * @export\n */\nconst exports = {\n  LINE_STRING: 'LineString',\n  POINT: 'Point',\n  POLYGON: 'Polygon'\n};\n\n\nexport default exports;\n"],"sourceRoot":""}